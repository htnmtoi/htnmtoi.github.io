<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>LLVM: llvm::GlobalLayoutBuilder Struct Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">mainline</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="namespacellvm.html">llvm</a>      </li>
      <li class="navelem"><a class="el" href="structllvm_1_1GlobalLayoutBuilder.html">GlobalLayoutBuilder</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a>  </div>
  <div class="headertitle">
<div class="title">llvm::GlobalLayoutBuilder Struct Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="llvm::GlobalLayoutBuilder" -->
<p>This class implements a layout algorithm for globals referenced by bit sets that tries to keep members of small bit sets together.  
 <a href="structllvm_1_1GlobalLayoutBuilder.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="LowerBitSets_8h_source.html">LowerBitSets.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for llvm::GlobalLayoutBuilder:</div>
<div class="dyncontent">
<div class="center"><img src="structllvm_1_1GlobalLayoutBuilder__coll__graph.png" border="0" usemap="#llvm_1_1GlobalLayoutBuilder_coll__map" alt="Collaboration graph"/></div>
<map name="llvm_1_1GlobalLayoutBuilder_coll__map" id="llvm_1_1GlobalLayoutBuilder_coll__map">
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="structllvm_1_1GlobalLayoutBuilder-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structllvm_1_1GlobalLayoutBuilder.html#a042a976424223cbb026440ccf1dd79c9">GlobalLayoutBuilder</a> (uint64_t NumObjects)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structllvm_1_1GlobalLayoutBuilder.html#abc53ed9289ca61898a56ea65b8a457db">addFragment</a> (<a class="el" href="AArch64PromoteConstant_8cpp.html#a90f8350fecae261c25be85d38b451bff">const</a> std::set&lt; uint64_t &gt; &amp;<a class="el" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Add F to the layout while trying to keep its indices contiguous.  <a href="#abc53ed9289ca61898a56ea65b8a457db"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::vector&lt; std::vector<br class="typebreak"/>
&lt; uint64_t &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structllvm_1_1GlobalLayoutBuilder.html#a4e40549ce20b33612f4e642e707a8d2c">Fragments</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The computed layout.  <a href="#a4e40549ce20b33612f4e642e707a8d2c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::vector&lt; uint64_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structllvm_1_1GlobalLayoutBuilder.html#a505cdc4608cae157cf9b4a1baaebf3c2">FragmentMap</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Mapping from object index to fragment index.  <a href="#a505cdc4608cae157cf9b4a1baaebf3c2"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>This class implements a layout algorithm for globals referenced by bit sets that tries to keep members of small bit sets together. </p>
<p>This can significantly reduce bit set sizes in many cases.</p>
<p>It works by assembling fragments of layout from sets of referenced globals. Each set of referenced globals causes the algorithm to create a new fragment, which is assembled by appending each referenced global in the set into the fragment. If a referenced global has already been referenced by an fragment created earlier, we instead delete that fragment and append its contents into the fragment we are assembling.</p>
<p>By starting with the smallest fragments, we minimize the size of the fragments that are copied into larger fragments. This is most intuitively thought about when considering the case where the globals are virtual tables and the bit sets represent their derived classes: in a single inheritance hierarchy, the optimum layout would involve a depth-first search of the class hierarchy (and in fact the computed layout ends up looking a lot like a DFS), but a naive DFS would not work well in the presence of multiple inheritance. This aspect of the algorithm ends up fitting smaller hierarchies inside larger ones where that would be beneficial.</p>
<p>For example, consider this class hierarchy:</p>
<p>A B \ / | \ C D E</p>
<p>We have five bit sets: bsA (A, C), bsB (B, C, D, E), bsC (C), bsD (D) and bsE (E). If we laid out our objects by DFS traversing B followed by A, our layout would be {B, C, D, E, A}. This is optimal for bsB as it needs to cover the only 4 objects in its hierarchy, but not for bsA as it needs to cover 5 objects, i.e. the entire layout. Our algorithm proceeds as follows:</p>
<p>Add bsC, fragments {{C}} Add bsD, fragments {{C}, {D}} Add bsE, fragments {{C}, {D}, {E}} Add bsA, fragments {{A, C}, {D}, {E}} Add bsB, fragments {{B, A, C, D, E}}</p>
<p>This layout is optimal for bsA, as it now only needs to cover two (i.e. 3 fewer) objects, at the cost of bsB needing to cover 1 more object.</p>
<p>The bit set lowering pass assigns an object index to each object that needs to be laid out, and calls addFragment for each bit set passing the object indices of its referenced globals. It then assembles a layout from the computed layout in the Fragments field. </p>

<p>Definition at line <a class="el" href="LowerBitSets_8h_source.html#l00126">126</a> of file <a class="el" href="LowerBitSets_8h_source.html">LowerBitSets.h</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a042a976424223cbb026440ccf1dd79c9"></a><!-- doxytag: member="llvm::GlobalLayoutBuilder::GlobalLayoutBuilder" ref="a042a976424223cbb026440ccf1dd79c9" args="(uint64_t NumObjects)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structllvm_1_1GlobalLayoutBuilder.html#a042a976424223cbb026440ccf1dd79c9">llvm::GlobalLayoutBuilder::GlobalLayoutBuilder</a> </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>NumObjects</em></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="LowerBitSets_8h_source.html#l00134">134</a> of file <a class="el" href="LowerBitSets_8h_source.html">LowerBitSets.h</a>.</p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="abc53ed9289ca61898a56ea65b8a457db"></a><!-- doxytag: member="llvm::GlobalLayoutBuilder::addFragment" ref="abc53ed9289ca61898a56ea65b8a457db" args="(const std::set&lt; uint64_t &gt; &amp;F)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="structllvm_1_1GlobalLayoutBuilder.html#abc53ed9289ca61898a56ea65b8a457db">GlobalLayoutBuilder::addFragment</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="AArch64PromoteConstant_8cpp.html#a90f8350fecae261c25be85d38b451bff">const</a> std::set&lt; uint64_t &gt; &amp;&#160;</td>
          <td class="paramname"><em>F</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add F to the layout while trying to keep its indices contiguous. </p>
<p>If a previously seen fragment uses any of F's indices, that fragment will be laid out inside F. </p>

<p>Definition at line <a class="el" href="LowerBitSets_8cpp_source.html#l00126">126</a> of file <a class="el" href="LowerBitSets_8cpp_source.html">LowerBitSets.cpp</a>.</p>

<p>References <a class="el" href="LowerBitSets_8h_source.html#l00132">FragmentMap</a>, and <a class="el" href="LowerBitSets_8h_source.html#l00129">Fragments</a>.</p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a505cdc4608cae157cf9b4a1baaebf3c2"></a><!-- doxytag: member="llvm::GlobalLayoutBuilder::FragmentMap" ref="a505cdc4608cae157cf9b4a1baaebf3c2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;uint64_t&gt; <a class="el" href="structllvm_1_1GlobalLayoutBuilder.html#a505cdc4608cae157cf9b4a1baaebf3c2">llvm::GlobalLayoutBuilder::FragmentMap</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Mapping from object index to fragment index. </p>

<p>Definition at line <a class="el" href="LowerBitSets_8h_source.html#l00132">132</a> of file <a class="el" href="LowerBitSets_8h_source.html">LowerBitSets.h</a>.</p>

<p>Referenced by <a class="el" href="LowerBitSets_8cpp_source.html#l00126">addFragment()</a>.</p>

</div>
</div>
<a class="anchor" id="a4e40549ce20b33612f4e642e707a8d2c"></a><!-- doxytag: member="llvm::GlobalLayoutBuilder::Fragments" ref="a4e40549ce20b33612f4e642e707a8d2c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;std::vector&lt;uint64_t&gt; &gt; <a class="el" href="structllvm_1_1GlobalLayoutBuilder.html#a4e40549ce20b33612f4e642e707a8d2c">llvm::GlobalLayoutBuilder::Fragments</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The computed layout. </p>
<p>Each element of this vector contains a fragment of layout (which may be empty) consisting of object indices. </p>

<p>Definition at line <a class="el" href="LowerBitSets_8h_source.html#l00129">129</a> of file <a class="el" href="LowerBitSets_8h_source.html">LowerBitSets.h</a>.</p>

<p>Referenced by <a class="el" href="LowerBitSets_8cpp_source.html#l00126">addFragment()</a>.</p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following files:<ul>
<li><a class="el" href="LowerBitSets_8h_source.html">LowerBitSets.h</a></li>
<li><a class="el" href="LowerBitSets_8cpp_source.html">LowerBitSets.cpp</a></li>
</ul>
</div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Thu Jul 2 2015 04:40:33 for LLVM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
